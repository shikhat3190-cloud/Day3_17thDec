import asyncio

from autogen_agentchat.agents import AssistantAgent, UserProxyAgent
from autogen_agentchat.conditions import TextMentionTermination
from autogen_agentchat.teams import RoundRobinGroupChat
from autogen_agentchat.ui import Console
from autogen_ext.models.openai import OpenAIChatCompletionClient
from dotenv import load_dotenv

load_dotenv()

async def main():
    # Create the agents
    model_client = OpenAIChatCompletionClient(model="gpt-4o-mini")
    assistant = AssistantAgent("assistant", model_client=model_client)
    user_proxy = UserProxyAgent(
        "user_proxy",
        input_func=input  # console input
    )

    # Termination condition
    termination = TextMentionTermination("APPROVE")

    # Create the team
    team = RoundRobinGroupChat(
        [assistant, user_proxy],
        termination_condition=termination
    )

    # Run the conversation
    stream = team.run_stream(
        task="Write a function to extract email from a sentence."
    )

    # Stream output to console
    await Console(stream)

    # Clean up
    await model_client.close()


if __name__ == "__main__":
    asyncio.run(main())
